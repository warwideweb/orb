<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#060B18">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/orb-192.png">
<title>ORB</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;300;400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{--cyan:#00D4FF;--blue:#0066FF;--violet:#7B2FFF;--bg:#060B18}
html,body{height:100%;overflow:hidden;background:var(--bg);color:#fff;font-family:'Plus Jakarta Sans',system-ui,sans-serif;-webkit-tap-highlight-color:transparent;touch-action:none;user-select:none}

/* â•â•â• SIMULATED HOME â•â•â• */
.home{position:fixed;inset:0;z-index:1;display:flex;flex-direction:column;transition:filter .3s,opacity .3s}
.home.blurred{filter:blur(4px) brightness(0.7)}
.home.hidden{opacity:0;pointer-events:none}

.wallpaper{position:absolute;inset:0;background:
  radial-gradient(ellipse 70% 50% at 75% 20%,rgba(30,50,120,0.3),transparent 60%),
  radial-gradient(ellipse 60% 45% at 20% 80%,rgba(60,20,100,0.25),transparent 55%),
  radial-gradient(circle at 50% 45%,rgba(20,40,80,0.2),transparent 50%),
  linear-gradient(180deg,#060B18,#0a1225,#060B18);z-index:0}
.wallpaper::after{content:'';position:absolute;inset:0;opacity:.03;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

.statusbar{position:fixed;top:0;left:0;right:0;height:32px;display:flex;align-items:center;justify-content:space-between;padding:0 16px;font-size:13px;font-weight:400;color:rgba(255,255,255,.65);z-index:200}
.statusbar svg{width:18px;height:18px;fill:currentColor}
.statusbar .r{display:flex;align-items:center;gap:6px}

.searchbar{margin:40px 16px 14px;height:46px;background:rgba(255,255,255,.08);border-radius:24px;display:flex;align-items:center;padding:0 14px;gap:10px}
.searchbar svg{width:20px;height:20px;fill:rgba(255,255,255,.45)}
.searchbar .g{font-size:18px;font-weight:500;background:linear-gradient(135deg,#4285F4,#34A853,#FBBC05,#EA4335);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.searchbar .sp{flex:1}

.appgrid{flex:1;display:grid;grid-template-columns:repeat(4,1fr);gap:16px 4px;padding:4px 12px;align-content:start;overflow:hidden}
.appi{display:flex;flex-direction:column;align-items:center;gap:5px;filter:brightness(.75)}
.appi-box{width:50px;height:50px;border-radius:13px;display:flex;align-items:center;justify-content:center}
.appi-box svg{width:24px;height:24px;fill:rgba(255,255,255,.9)}
.appi-lbl{font-size:10px;font-weight:300;color:rgba(255,255,255,.55);text-align:center;width:58px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

.dock{position:fixed;bottom:32px;left:12px;right:12px;height:70px;background:rgba(255,255,255,.04);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:22px;display:flex;justify-content:space-around;align-items:center;z-index:150}
.dock .appi-box{width:48px;height:48px;border-radius:12px}

.pagedots{position:fixed;bottom:106px;left:0;right:0;display:flex;justify-content:center;gap:4px;z-index:150}
.pagedots span{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.2)}
.pagedots span.active{background:rgba(255,255,255,.6)}

.navbar{position:fixed;bottom:8px;left:0;right:0;display:flex;justify-content:center;z-index:200}
.navpill{width:134px;height:5px;background:rgba(255,255,255,.35);border-radius:3px}

/* â•â•â• OVERLAY â•â•â• */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0);pointer-events:none;transition:background .3s;z-index:50}
.overlay.active{background:rgba(0,0,0,.65);pointer-events:auto}

/* â•â•â• FLOATING ORB â•â•â• */
.forb{position:fixed;z-index:100;cursor:grab;touch-action:none;transition:opacity .25s}
.forb.drag{cursor:grabbing}
.forb.dim{opacity:.45}
.forb.tuck{transition:transform .3s}

.forb-inner{position:relative;width:64px;height:64px}
.forb-glow{position:absolute;inset:-30%;width:160%;height:160%;background:radial-gradient(circle,rgba(0,180,255,.25),transparent 60%);filter:blur(12px);opacity:.5;transition:opacity .2s}
#fcanvas{width:64px;height:64px}
.forb-shadow{position:absolute;bottom:-5px;left:12px;right:12px;height:10px;background:radial-gradient(ellipse,rgba(0,0,0,.35),transparent 70%);filter:blur(5px)}
.nbadge{position:absolute;top:-5px;right:-5px;min-width:18px;height:18px;background:#FF3B30;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:500;color:#fff;padding:0 4px;transform:scale(0);transition:transform .25s cubic-bezier(.175,.885,.32,1.275)}
.nbadge.vis{transform:scale(1)}

/* â•â•â• EXPANDED â•â•â• */
.exporb{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);opacity:0;pointer-events:none;transition:all .4s cubic-bezier(.175,.885,.32,1.275);z-index:100}
.exporb.active{transform:translate(-50%,-50%) scale(1);opacity:1;pointer-events:auto}
.exporb-wrap{position:relative;width:min(75vw,300px);height:min(75vw,300px);display:flex;align-items:center;justify-content:center}
.exporb-glow{position:absolute;width:150%;height:150%;border-radius:50%;background:radial-gradient(circle,rgba(0,180,255,.12),rgba(123,47,255,.05) 50%,transparent 70%);filter:blur(40px)}
#ecanvas{position:absolute;inset:0}

/* â•â•â• RADIAL MENU â•â•â• */
.rmenu{position:absolute;inset:0;pointer-events:none}
.ricon{position:absolute;width:58px;height:58px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:rgba(255,255,255,.06);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08);opacity:0;transform:scale(0);transition:all .4s cubic-bezier(.175,.885,.32,1.275);pointer-events:none;cursor:pointer}
.ricon.vis{opacity:1;transform:scale(1) translate(var(--x),var(--y));pointer-events:auto}
.ricon.top{border-color:rgba(0,200,255,.15);box-shadow:0 0 15px rgba(0,200,255,.12)}
.ricon:active{transform:scale(.9) translate(var(--x),var(--y))!important;background:rgba(0,102,255,.2)}
.ricon svg{width:24px;height:24px;stroke:rgba(255,255,255,.65);stroke-width:1.5;fill:none}
.ricon-lbl{position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);font-size:10px;font-weight:300;color:rgba(255,255,255,.4);white-space:nowrap}
.ricon-dot{position:absolute;top:-2px;right:-2px;width:7px;height:7px;border-radius:50%}

/* Quick actions */
.qpill{position:absolute;background:rgba(255,255,255,.07);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:8px 14px;font-size:11px;font-weight:300;color:rgba(255,255,255,.7);white-space:nowrap;opacity:0;transform:scale(.8);transition:all .25s cubic-bezier(.175,.885,.32,1.275);pointer-events:none;cursor:pointer;z-index:110}
.qpill.vis{opacity:1;transform:scale(1) translate(var(--qx),var(--qy));pointer-events:auto}
.qpill:active{background:rgba(0,102,255,.2)}

/* â•â•â• VOICE â•â•â• */
.voverlay{position:fixed;inset:0;background:rgba(0,0,0,.8);opacity:0;pointer-events:none;transition:opacity .3s;z-index:90}
.voverlay.active{opacity:1;pointer-events:auto}
.vorb{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);width:200px;height:200px;opacity:0;transition:all .4s cubic-bezier(.175,.885,.32,1.275);z-index:100}
.vorb.active{transform:translate(-50%,-50%) scale(1);opacity:1}
#vcanvas{width:100%;height:100%}
.vtext{position:fixed;top:calc(50% + 120px);left:0;right:0;text-align:center;z-index:100;pointer-events:none}
.vstatus{font-size:12px;font-weight:200;color:rgba(0,212,255,.7);letter-spacing:4px;text-transform:uppercase;margin-bottom:12px;opacity:0;transition:opacity .3s}
.voverlay.active~.vtext .vstatus{opacity:1}
.vtrans{font-size:20px;font-weight:300;min-height:28px;padding:0 28px;opacity:0;transition:opacity .3s}
.voverlay.active~.vtext .vtrans{opacity:1}
.vresp{font-size:15px;font-weight:300;color:rgba(255,255,255,.55);padding:0 28px;margin-top:10px;opacity:0;transition:opacity .3s}
.voverlay.active~.vtext .vresp{opacity:1}

/* â•â•â• INFO CARD â•â•â• */
.icard{position:fixed;background:rgba(255,255,255,.05);backdrop-filter:blur(25px);-webkit-backdrop-filter:blur(25px);border:1px solid rgba(255,255,255,.06);border-radius:18px;padding:16px 20px;opacity:0;pointer-events:none;transition:all .3s;z-index:120;width:230px}
.icard.vis{opacity:1;pointer-events:auto}
.icard .tm{font-size:28px;font-weight:200}
.icard .dt{font-size:12px;font-weight:300;color:rgba(255,255,255,.35);margin-top:2px}
.icard .div{height:1px;background:rgba(255,255,255,.05);margin:12px 0}
.icard .wt{font-size:13px;font-weight:300;color:rgba(255,255,255,.45)}
.icard .ev{font-size:12px;font-weight:300;color:rgba(255,255,255,.35);margin-top:8px}

/* â•â•â• LAUNCHER â•â•â• */
.launcher{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .4s;z-index:1}
.launcher.active{opacity:1;pointer-events:auto}
.launcher .wallpaper{opacity:.5}
.launcher .statusbar{color:rgba(255,255,255,.3)}
.lorb{position:relative;width:min(75vw,320px);height:min(75vw,320px);cursor:pointer;z-index:10}
.lorb-glow{position:absolute;inset:-25%;width:150%;height:150%;border-radius:50%;background:radial-gradient(circle,rgba(0,180,255,.1),transparent 60%);filter:blur(40px)}
#lcanvas{width:100%;height:100%}
.lsugg{display:flex;gap:10px;margin-top:28px;z-index:10;position:relative}
.lsugg-lbl{position:absolute;top:-16px;left:0;font-size:8px;color:rgba(255,255,255,.15);letter-spacing:1px;text-transform:uppercase}
.lsugg-pill{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.05);border-radius:18px;padding:7px 12px;cursor:pointer;transition:background .15s}
.lsugg-pill:active{background:rgba(255,255,255,.1)}
.lsugg-icon{width:20px;height:20px;border-radius:5px;display:flex;align-items:center;justify-content:center}
.lsugg-icon svg{width:12px;height:12px;fill:#fff}
.lsugg-name{font-size:11px;font-weight:300;color:rgba(255,255,255,.4)}
.lbrand{position:absolute;bottom:calc(env(safe-area-inset-bottom,20px) + 50px);font-size:10px;font-weight:300;letter-spacing:8px;color:rgba(255,255,255,.06);z-index:10}

/* App drawer */
.adrawer{position:fixed;inset:0;background:rgba(10,15,30,.94);backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);transform:translateY(100%);transition:transform .4s cubic-bezier(.22,1,.36,1);z-index:160;border-radius:24px 24px 0 0;padding-top:12px}
.adrawer.open{transform:translateY(0)}
.adrawer-handle{width:40px;height:4px;background:rgba(255,255,255,.2);border-radius:2px;margin:0 auto 16px}
.adrawer-search{margin:0 20px 16px;height:42px;background:rgba(255,255,255,.06);border-radius:12px;display:flex;align-items:center;padding:0 14px;font-size:13px;color:rgba(255,255,255,.25)}
.adrawer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:20px 8px;padding:0 16px 100px;overflow-y:auto;max-height:calc(100vh - 100px)}

/* Notif shade */
.nshade{position:fixed;top:0;left:0;right:0;background:rgba(10,15,30,.92);backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);transform:translateY(-100%);transition:transform .35s cubic-bezier(.22,1,.36,1);z-index:170;padding:44px 16px 24px;max-height:70vh;overflow:auto;border-radius:0 0 24px 24px}
.nshade.open{transform:translateY(0)}
.nshade-title{font-size:11px;color:rgba(255,255,255,.35);margin-bottom:12px;letter-spacing:1px}
.ncard{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.05);border-radius:16px;padding:12px 14px;margin-bottom:10px;cursor:pointer;transition:background .15s}
.ncard:active{background:rgba(255,255,255,.1)}
.ncard-app{font-size:10px;color:rgba(255,255,255,.4);margin-bottom:3px}
.ncard-text{font-size:13px;font-weight:300;color:rgba(255,255,255,.75)}
.ncard-time{font-size:10px;color:rgba(255,255,255,.25);margin-top:3px}

/* Ambient */
.ambient-time{position:fixed;top:calc(50% - 180px);left:0;right:0;text-align:center;font-size:48px;font-weight:200;color:rgba(255,255,255,.25);opacity:0;transition:opacity .5s;z-index:100;pointer-events:none}
.ambient-time.vis{opacity:1}
.ambient-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);opacity:0;pointer-events:none;transition:opacity .5s;z-index:90}
.ambient-overlay.vis{opacity:1}

/* â•â•â• MODE SWITCH â•â•â• */
.mswitch{position:fixed;bottom:calc(env(safe-area-inset-bottom,12px) + 8px);left:50%;transform:translateX(-50%);display:flex;gap:16px;background:rgba(255,255,255,.03);border-radius:20px;padding:7px 18px;z-index:200}
.mswitch-btn{font-size:10px;font-weight:400;letter-spacing:1px;text-transform:uppercase;color:rgba(255,255,255,.15);cursor:pointer;padding:4px 0;border-bottom:1px solid transparent;transition:all .2s}
.mswitch-btn.active{color:rgba(255,255,255,.5);border-bottom-color:rgba(0,200,255,.4)}

/* â•â•â• TOAST â•â•â• */
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);background:rgba(20,25,40,.92);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px 18px;font-size:13px;font-weight:300;color:rgba(255,255,255,.75);opacity:0;transition:all .3s;z-index:250;white-space:nowrap}
.toast.vis{opacity:1;transform:translateX(-50%) translateY(0)}

/* Dismiss zone */
.dzone{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:56px;height:56px;border-radius:50%;background:rgba(255,100,100,.08);border:2px dashed rgba(255,100,100,.25);display:flex;align-items:center;justify-content:center;font-size:20px;color:rgba(255,100,100,.4);opacity:0;pointer-events:none;transition:all .2s;z-index:99}
.dzone.vis{opacity:1}
.dzone.hot{transform:translateX(-50%) scale(1.2);background:rgba(255,100,100,.15);border-color:rgba(255,100,100,.4)}

/* Restore pill */
.restore{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.06);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:10px 18px;font-size:11px;font-weight:300;color:rgba(255,255,255,.5);cursor:pointer;opacity:0;pointer-events:none;transition:all .3s;z-index:200}
.restore.vis{opacity:1;pointer-events:auto}

/* Onboard */
.onboard{position:fixed;z-index:150;pointer-events:none;text-align:center;opacity:0;transition:opacity .5s}
.onboard.vis{opacity:1}
.onboard-title{font-size:16px;font-weight:200;letter-spacing:2px;color:rgba(255,255,255,.7)}
.onboard-sub{font-size:12px;font-weight:300;color:rgba(255,255,255,.45);margin-top:8px}
</style>
</head>
<body>

<!-- HOME -->
<div class="home" id="home">
  <div class="wallpaper"></div>
  <div class="statusbar"><span id="clock"></span><div class="r"><svg viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0114.08 0M1.42 9a16 16 0 0121.16 0M8.53 16.11a6 6 0 016.95 0M12 20h.01"/></svg><svg viewBox="0 0 24 24"><rect x="1" y="6" width="18" height="12" rx="2"/><line x1="23" y1="13" x2="23" y2="11" stroke="currentColor" stroke-width="2"/></svg><span style="font-size:11px">87%</span></div></div>
  <div class="searchbar"><span class="g">G</span><div class="sp"></div><svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/></svg></div>
  <div class="appgrid" id="appgrid"></div>
  <div class="dock" id="dock"></div>
  <div class="pagedots"><span class="active"></span><span></span><span></span></div>
  <div class="navbar"><div class="navpill"></div></div>
</div>

<!-- FLOATING ORB -->
<div class="forb" id="forb">
  <div class="forb-inner">
    <div class="forb-glow" id="fglow"></div>
    <canvas id="fcanvas" width="128" height="128"></canvas>
  </div>
  <div class="forb-shadow"></div>
  <div class="nbadge" id="nbadge">3</div>
</div>

<!-- OVERLAY -->
<div class="overlay" id="overlay"></div>

<!-- EXPANDED -->
<div class="exporb" id="exporb">
  <div class="exporb-wrap">
    <div class="exporb-glow"></div>
    <canvas id="ecanvas"></canvas>
    <div class="rmenu" id="rmenu"></div>
  </div>
</div>

<!-- VOICE -->
<div class="voverlay" id="voverlay"></div>
<div class="vorb" id="vorb"><canvas id="vcanvas" width="400" height="400"></canvas></div>
<div class="vtext"><div class="vstatus" id="vstatus">Listening</div><div class="vtrans" id="vtrans"></div><div class="vresp" id="vresp"></div></div>

<!-- INFO CARD -->
<div class="icard" id="icard"><div class="tm" id="itm"></div><div class="dt" id="idt"></div><div class="div"></div><div class="wt">â˜€ï¸ 72Â°F Sunny</div><div class="ev">ğŸ“… Team standup Â· 3:00 PM</div></div>

<!-- LAUNCHER -->
<div class="launcher" id="launcher">
  <div class="wallpaper"></div>
  <div class="statusbar"><span id="lclock"></span><div class="r"><svg viewBox="0 0 24 24"><rect x="1" y="6" width="18" height="12" rx="2"/></svg></div></div>
  <div class="lorb" id="lorb"><div class="lorb-glow"></div><canvas id="lcanvas"></canvas></div>
  <div class="lsugg" id="lsugg"><span class="lsugg-lbl">Suggested</span></div>
  <div class="lbrand">O R B</div>
</div>

<!-- DRAWER -->
<div class="adrawer" id="adrawer"><div class="adrawer-handle"></div><div class="adrawer-search">Search apps...</div><div class="adrawer-grid" id="adgrid"></div></div>

<!-- NOTIF SHADE -->
<div class="nshade" id="nshade">
  <div class="nshade-title">NOTIFICATIONS</div>
  <div class="ncard"><div class="ncard-app">Messages</div><div class="ncard-text">Mom: Are you coming for dinner?</div><div class="ncard-time">5m ago</div></div>
  <div class="ncard"><div class="ncard-app">Gmail</div><div class="ncard-text">Meeting notes shared</div><div class="ncard-time">23m ago</div></div>
  <div class="ncard"><div class="ncard-app">Spotify</div><div class="ncard-text">Your Daily Mix is ready</div><div class="ncard-time">1h ago</div></div>
</div>

<!-- AMBIENT -->
<div class="ambient-overlay" id="ambov"></div>
<div class="ambient-time" id="ambtm"></div>

<!-- MODE SWITCH -->
<div class="mswitch" id="mswitch"><div class="mswitch-btn active" data-m="overlay">Overlay</div><div class="mswitch-btn" data-m="launcher">ORB Mode</div></div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- DISMISS -->
<div class="dzone" id="dzone">Ã—</div>
<div class="restore" id="restore">Restore ORB</div>

<!-- ONBOARD -->
<div class="onboard" id="onboard"><div class="onboard-title">Meet ORB</div><div class="onboard-sub">Tap Â· Hold Â· Drag</div></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ICONS={
Phone:`<svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.1.65.26 1.29.5 1.9a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.61.24 1.25.4 1.9.5A2 2 0 0122 16.92z"/></svg>`,
Messages:`<svg viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"/></svg>`,
Camera:`<svg viewBox="0 0 24 24"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>`,
Music:`<svg viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`,
Mail:`<svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>`,
Map:`<svg viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
Instagram:`<svg viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/></svg>`,
X:`<svg viewBox="0 0 24 24"><path d="M4 4l11.5 16h4.5l-11.5-16z"/><path d="M4 20l6.5-6.5M20 4l-6.5 6.5"/></svg>`
};
const APPS=[
{i:'Phone',n:'Phone',c:'#34C759',q:['Call Recent','Voicemail']},
{i:'Messages',n:'Messages',c:'#34C759',q:['New Message','Unread']},
{i:'Camera',n:'Camera',c:'#0066FF',q:['Photo','Video','Selfie']},
{i:'Music',n:'Spotify',c:'#1DB954',q:['Resume','Discover']},
{i:'Mail',n:'Gmail',c:'#FF3B30',q:['Compose','Inbox']},
{i:'Map',n:'Maps',c:'#4285F4',q:['Home','Work']},
{i:'Instagram',n:'Instagram',c:'#E1306C',q:['Feed','Stories']},
{i:'X',n:'X',c:'#1DA1F2',q:['Feed','Post','DMs']}
];
const GRID_APPS=[
{n:'Chrome',c:'#4285F4'},{n:'YouTube',c:'#FF0000'},{n:'Photos',c:'#4285F4'},{n:'Play Store',c:'#00C853'},
{n:'Settings',c:'#607D8B'},{n:'Clock',c:'#1A73E8'},{n:'Files',c:'#1A73E8'},{n:'Calculator',c:'#5BB974'},
{n:'WhatsApp',c:'#25D366'},{n:'Slack',c:'#611F69'},{n:'Notion',c:'#2D2D2D'},{n:'Drive',c:'#F4B400'},
{n:'Uber',c:'#000'},{n:'Amazon',c:'#FF9900'},{n:'Netflix',c:'#E50914'},{n:'Twitch',c:'#9146FF'}
];
const DOCK_APPS=['Phone','Messages','Camera','Mail','Map'];

let notifCount=Math.floor(Math.random()*6)+1;
let notifs={Messages:Math.ceil(notifCount/2),Gmail:Math.floor(notifCount/2)};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let mode=localStorage.getItem('orb_mode')||'overlay';
let orbPos=JSON.parse(localStorage.getItem('orb_pos'))||{x:window.innerWidth-72,y:window.innerHeight/2-32};
let state='floating'; // floating|expanded|voice|ambient
let drag={active:false,moved:0,startX:0,startY:0,velX:0,velY:0};
let dimTimer,tuckTimer;
let qactions=null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTICLES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PHI=Math.PI*(3-Math.sqrt(5));
const dpr=Math.min(devicePixelRatio||1,2);

function mkParts(n){
  const p=[];
  for(let i=0;i<n;i++){
    const y=1-(i/(n-1))*2,r=Math.sqrt(1-y*y),th=PHI*i;
    const hr=Math.random();
    p.push({bx:Math.cos(th)*r,by:y,bz:Math.sin(th)*r,x:0,y:0,z:0,
      sz:.8+Math.random()*1.4,hue:hr<.4?190:hr<.7?220:270,
      al:.3+Math.random()*.4,ph:Math.random()*Math.PI*2,dr:.012+Math.random()*.018});
  }
  return p;
}

function renderSphere(ctx,p,W,H,rotY,sc=1,br=1,ring=false,audio=0){
  ctx.clearRect(0,0,W,H);
  const cx=W/2,cy=H/2,R=Math.min(W,H)*.38,t=performance.now();
  const cosY=Math.cos(rotY),sinY=Math.sin(rotY);
  const proj=p.map(pt=>{
    let d=Math.sin(t*.001+pt.ph)*pt.dr;
    let x=pt.bx+d,y=pt.by,z=pt.bz;
    if(ring){y*=.3;const rr=Math.sqrt(x*x+z*z);if(rr>.3){const a=Math.atan2(z,x),disp=audio*.15*Math.sin(t*.003+a*5);x=Math.cos(a)*(rr+disp);z=Math.sin(a)*(rr+disp);}}
    const rx=x*cosY-z*sinY,rz=x*sinY+z*cosY;
    return{...pt,x:rx,y,z:rz};
  }).sort((a,b)=>a.z-b.z);
  ctx.globalCompositeOperation='lighter';
  for(const pt of proj){
    const s=200/(200+pt.z*R),sx=cx+pt.x*R*s*sc,sy=cy+pt.y*R*s*sc;
    const al=pt.al*(.5+(pt.z+1)*.25)*br,sz=pt.sz*s*sc;
    ctx.beginPath();ctx.arc(sx,sy,sz*2.5,0,Math.PI*2);ctx.fillStyle=`hsla(${pt.hue},100%,70%,${al*.12})`;ctx.fill();
    ctx.beginPath();ctx.arc(sx,sy,sz,0,Math.PI*2);ctx.fillStyle=`hsla(${pt.hue},100%,75%,${al})`;ctx.fill();
  }
  ctx.globalCompositeOperation='source-over';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FLOATING ORB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const forb=document.getElementById('forb');
const fcanvas=document.getElementById('fcanvas');
const fctx=fcanvas.getContext('2d');
const fglow=document.getElementById('fglow');
const nbadge=document.getElementById('nbadge');
let fparts=mkParts(350);
let frotY=0;

fcanvas.width=128*dpr;fcanvas.height=128*dpr;
fctx.setTransform(dpr,0,0,dpr,0,0);

function updForb(){forb.style.transform=`translate(${orbPos.x}px,${orbPos.y}px)`;}
updForb();

function animFloat(){
  if(mode!=='overlay'||state!=='floating'){requestAnimationFrame(animFloat);return;}
  frotY+=.0015;
  renderSphere(fctx,fparts,128,128,frotY);
  requestAnimationFrame(animFloat);
}
animFloat();

if(notifCount>0){nbadge.textContent=notifCount;nbadge.classList.add('vis');}

function snapEdge(){
  const tgt=orbPos.x<window.innerWidth/2?8:window.innerWidth-72;
  let vel=0;
  const anim=()=>{
    vel+=(tgt-orbPos.x)*.12;vel*=.72;orbPos.x+=vel;
    if(Math.abs(vel)<.5&&Math.abs(orbPos.x-tgt)<1){orbPos.x=tgt;updForb();savePos();return;}
    updForb();requestAnimationFrame(anim);
  };
  anim();
}
function savePos(){localStorage.setItem('orb_pos',JSON.stringify(orbPos));}

function startTimers(){
  clearTimeout(dimTimer);clearTimeout(tuckTimer);
  forb.classList.remove('dim','tuck');
  dimTimer=setTimeout(()=>forb.classList.add('dim'),15000);
  tuckTimer=setTimeout(()=>{
    const off=orbPos.x<window.innerWidth/2?-34:34;
    forb.classList.add('tuck');
    forb.style.transform=`translate(${orbPos.x+off}px,${orbPos.y}px)`;
  },25000);
}
startTimers();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const dzone=document.getElementById('dzone');
const restore=document.getElementById('restore');

forb.addEventListener('pointerdown',e=>{
  if(state!=='floating')return;
  e.preventDefault();
  drag={active:true,moved:0,startX:e.clientX-orbPos.x,startY:e.clientY-orbPos.y,velX:0,velY:0};
  forb.classList.remove('dim','tuck');
  forb.style.transform=`translate(${orbPos.x}px,${orbPos.y}px)`;
  clearTimeout(dimTimer);clearTimeout(tuckTimer);
});

document.addEventListener('pointermove',e=>{
  if(!drag.active)return;
  const nx=e.clientX-drag.startX,ny=e.clientY-drag.startY;
  drag.moved+=Math.abs(nx-orbPos.x)+Math.abs(ny-orbPos.y);
  orbPos.x+=(nx-orbPos.x)*.25;orbPos.y+=(ny-orbPos.y)*.25;
  orbPos.y=Math.max(40,Math.min(window.innerHeight-140,orbPos.y));
  updForb();
  if(orbPos.y>window.innerHeight-130){dzone.classList.add('vis');if(orbPos.y>window.innerHeight-100&&Math.abs(orbPos.x-window.innerWidth/2+32)<50)dzone.classList.add('hot');else dzone.classList.remove('hot');}
  else{dzone.classList.remove('vis','hot');}
});

document.addEventListener('pointerup',e=>{
  if(!drag.active)return;
  drag.active=false;
  dzone.classList.remove('vis','hot');
  if(dzone.classList.contains('hot')||orbPos.y>window.innerHeight-100&&Math.abs(orbPos.x-window.innerWidth/2+32)<50){
    forb.style.transition='all .2s';forb.style.transform='translate(50%,100%) scale(0)';forb.style.opacity='0';
    haptic([10,20,10]);
    setTimeout(()=>{forb.style.transition='';restore.classList.add('vis');setTimeout(()=>restore.classList.remove('vis'),6000);},200);
    return;
  }
  if(drag.moved<12){handleTap();}else{snapEdge();}
  startTimers();
});

restore.addEventListener('click',()=>{
  restore.classList.remove('vis');
  orbPos={x:window.innerWidth-72,y:window.innerHeight/2-32};
  forb.style.transform=`translate(${orbPos.x}px,${orbPos.y}px)`;
  forb.style.opacity='1';
  startTimers();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAP â†’ EXPAND
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const overlay=document.getElementById('overlay');
const exporb=document.getElementById('exporb');
const ecanvas=document.getElementById('ecanvas');
const ectx=ecanvas.getContext('2d');
const rmenu=document.getElementById('rmenu');
let eparts=mkParts(1400);
let erotY=0;

function initECanvas(){
  const sz=Math.min(window.innerWidth*.75,300);
  ecanvas.width=sz*dpr;ecanvas.height=sz*dpr;
  ecanvas.style.width=sz+'px';ecanvas.style.height=sz+'px';
  ectx.setTransform(dpr,0,0,dpr,0,0);
}
initECanvas();

function animExp(){
  if(state!=='expanded'){requestAnimationFrame(animExp);return;}
  erotY+=.001;
  const sz=parseInt(ecanvas.style.width);
  renderSphere(ectx,eparts,sz,sz,erotY,.85,.55);
  requestAnimationFrame(animExp);
}
animExp();

function handleTap(){
  if(state==='floating')expand();
}

function expand(){
  state='expanded';
  haptic(12);
  forb.style.opacity='0';
  overlay.classList.add('active');
  document.getElementById('home').classList.add('blurred');
  exporb.classList.add('active');
  nbadge.classList.remove('vis');
  buildMenu();
  setTimeout(()=>rmenu.querySelectorAll('.ricon').forEach(el=>el.classList.add('vis')),80);
}

function collapse(){
  state='floating';
  haptic(8);
  rmenu.querySelectorAll('.ricon').forEach(el=>el.classList.remove('vis'));
  closeQA();
  setTimeout(()=>{
    exporb.classList.remove('active');
    overlay.classList.remove('active');
    document.getElementById('home').classList.remove('blurred');
    forb.style.opacity='1';
    if(notifCount>0)nbadge.classList.add('vis');
    startTimers();
  },200);
}

overlay.addEventListener('click',collapse);
exporb.addEventListener('click',e=>{if(e.target===exporb||e.target.classList.contains('exporb-wrap'))collapse();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â˜… MAGNETIC EDGE-AWARE MENU â˜…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildMenu(){
  rmenu.innerHTML='';
  const sorted=[...APPS].sort((a,b)=>(localStorage.getItem('c_'+b.n)||0)-(localStorage.getItem('c_'+a.n)||0));
  const wrap=document.querySelector('.exporb-wrap');
  const rect=wrap.getBoundingClientRect();
  const cx=rect.left+rect.width/2,cy=rect.top+rect.height/2;
  const orbR=rect.width*.7;
  const pad=45,sbH=40,dockH=110;
  const vw=window.innerWidth,vh=window.innerHeight;
  
  // Calculate base positions
  let icons=sorted.map((app,i)=>{
    const ang=-Math.PI/2+(i/sorted.length)*Math.PI*2;
    return{app,ang,bx:cx+Math.cos(ang)*orbR,by:cy+Math.sin(ang)*orbR,x:0,y:0};
  });
  
  // Apply edge repulsion
  const thresh=orbR*.6;
  icons.forEach(ic=>{
    let fx=0,fy=0;
    const dl=ic.bx-pad;if(dl<thresh)fx+=Math.pow((thresh-dl)/thresh,2)*orbR*.7;
    const dr=vw-pad-ic.bx;if(dr<thresh)fx-=Math.pow((thresh-dr)/thresh,2)*orbR*.7;
    const dt=ic.by-pad-sbH;if(dt<thresh)fy+=Math.pow((thresh-dt)/thresh,2)*orbR*.7;
    const db=vh-dockH-pad-ic.by;if(db<thresh)fy-=Math.pow((thresh-db)/thresh,2)*orbR*.7;
    ic.x=Math.max(pad,Math.min(vw-pad,ic.bx+fx));
    ic.y=Math.max(pad+sbH,Math.min(vh-dockH-pad,ic.by+fy));
  });
  
  // Separation pass (3x)
  for(let p=0;p<3;p++){
    for(let i=0;i<icons.length;i++){
      for(let j=i+1;j<icons.length;j++){
        const dx=icons[j].x-icons[i].x,dy=icons[j].y-icons[i].y;
        const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<68){
          const over=(68-dist)/2;
          const ang=Math.atan2(dy,dx);
          icons[i].x-=Math.cos(ang)*over;icons[i].y-=Math.sin(ang)*over;
          icons[j].x+=Math.cos(ang)*over;icons[j].y+=Math.sin(ang)*over;
        }
      }
    }
  }
  
  // Render
  icons.forEach((ic,i)=>{
    const el=document.createElement('div');
    el.className='ricon'+(i===0?' top':'');
    const tx=ic.x-cx,ty=ic.y-cy;
    el.style.setProperty('--x',tx+'px');
    el.style.setProperty('--y',ty+'px');
    el.style.transitionDelay=(i*35)+'ms';
    el.style.left='50%';el.style.top='50%';el.style.marginLeft='-29px';el.style.marginTop='-29px';
    let html=ICONS[ic.app.i]+`<span class="ricon-lbl">${ic.app.n}</span>`;
    if(notifs[ic.app.n])html+=`<span class="ricon-dot" style="background:${ic.app.c}"></span>`;
    el.innerHTML=html;
    el.dataset.app=JSON.stringify(ic.app);
    el.dataset.ang=ic.ang;
    
    let holdT;
    el.addEventListener('pointerdown',e=>{e.stopPropagation();holdT=setTimeout(()=>showQA(ic.app,el,ic.ang),400);});
    el.addEventListener('pointerup',e=>{e.stopPropagation();clearTimeout(holdT);if(!qactions)launchApp(ic.app,el);});
    el.addEventListener('pointerleave',()=>clearTimeout(holdT));
    
    rmenu.appendChild(el);
  });
}

function showQA(app,el,ang){
  haptic(10);closeQA();qactions=app.n;
  const acts=app.q||[];
  const base=ang+Math.PI;
  acts.forEach((a,i)=>{
    const pill=document.createElement('div');
    pill.className='qpill';
    const aa=base+(i-(acts.length-1)/2)*.35;
    pill.style.setProperty('--qx',Math.cos(aa)*70+'px');
    pill.style.setProperty('--qy',Math.sin(aa)*70+'px');
    pill.style.transitionDelay=(i*25)+'ms';
    pill.textContent=a;
    pill.style.left='50%';pill.style.top='50%';
    pill.addEventListener('click',e=>{e.stopPropagation();haptic(15);toast(`Opening ${a}...`);collapse();});
    rmenu.appendChild(pill);
    requestAnimationFrame(()=>pill.classList.add('vis'));
  });
}

function closeQA(){
  qactions=null;
  rmenu.querySelectorAll('.qpill').forEach(p=>p.remove());
}

function launchApp(app,el){
  haptic([15,40,25]);
  localStorage.setItem('c_'+app.n,(parseInt(localStorage.getItem('c_'+app.n)||0)+1));
  el.style.transition='transform .35s ease-in,opacity .3s';
  el.style.transform='scale(20)';el.style.opacity='0';
  rmenu.querySelectorAll('.ricon').forEach(e=>{if(e!==el){e.style.transition='opacity .15s';e.style.opacity='0';}});
  setTimeout(()=>{toast(app.n);collapse();},350);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOLD â†’ VOICE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const voverlay=document.getElementById('voverlay');
const vorb=document.getElementById('vorb');
const vcanvas=document.getElementById('vcanvas');
const vctx=vcanvas.getContext('2d');
const vstatus=document.getElementById('vstatus');
const vtrans=document.getElementById('vtrans');
const vresp=document.getElementById('vresp');
let vparts=mkParts(900);
let vrotY=0,audio=0,taudio=0;
let recognition,recognizing=false;

vcanvas.width=400*dpr;vcanvas.height=400*dpr;
vctx.setTransform(dpr,0,0,dpr,0,0);

function animVoice(){
  if(state!=='voice'){requestAnimationFrame(animVoice);return;}
  vrotY+=.002;audio+=(taudio-audio)*.15;
  renderSphere(vctx,vparts,400,400,vrotY,1,1.1,true,audio);
  requestAnimationFrame(animVoice);
}
animVoice();

let holdT;
forb.addEventListener('pointerdown',()=>{holdT=setTimeout(enterVoice,500);});
forb.addEventListener('pointerup',()=>clearTimeout(holdT));
forb.addEventListener('pointerleave',()=>clearTimeout(holdT));

function enterVoice(){
  if(state!=='floating')return;
  state='voice';
  haptic([10,30,20,30,40]);
  forb.style.opacity='0';
  voverlay.classList.add('active');
  vorb.classList.add('active');
  vtrans.textContent='';vresp.textContent='';vstatus.textContent='Listening';
  simAudio();startRec();
}

function exitVoice(){
  state='floating';
  voverlay.classList.remove('active');
  vorb.classList.remove('active');
  forb.style.opacity='1';
  taudio=0;
  if(recognition&&recognizing)try{recognition.stop();}catch(e){}
  startTimers();
}

let audioSim;
function simAudio(){clearInterval(audioSim);audioSim=setInterval(()=>{if(state!=='voice'){clearInterval(audioSim);return;}taudio=.02+Math.random()*.06;},100);}

function startRec(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){vstatus.textContent='Not supported';setTimeout(exitVoice,2000);return;}
  recognition=new SR();recognition.lang='en-US';recognition.interimResults=true;
  recognition.onstart=()=>{recognizing=true;};
  recognition.onresult=e=>{
    let f='',int='';
    for(let i=e.resultIndex;i<e.results.length;i++){if(e.results[i].isFinal)f+=e.results[i][0].transcript;else int+=e.results[i][0].transcript;}
    vtrans.textContent=f||int;taudio=.3+Math.random()*.5;
    if(f)procCmd(f.toLowerCase());
  };
  recognition.onend=()=>{recognizing=false;if(state==='voice'&&!vtrans.textContent)try{recognition.start();}catch(e){}};
  try{recognition.start();}catch(e){}
}

function procCmd(cmd){
  vstatus.textContent='Processing';taudio=0;
  let resp=cmd.includes('time')?`It's ${new Date().toLocaleTimeString([],{hour:'numeric',minute:'2-digit'})}`:'Got it';
  setTimeout(()=>{vstatus.textContent='';vresp.textContent=resp;if('speechSynthesis'in window)speechSynthesis.speak(new SpeechSynthesisUtterance(resp));setTimeout(exitVoice,2000);},400);
}

voverlay.addEventListener('click',exitVoice);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SWIPE â†’ INFO CARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const icard=document.getElementById('icard');
const itm=document.getElementById('itm');
const idt=document.getElementById('idt');
let swY=0,icardT;

forb.addEventListener('touchstart',e=>{swY=e.touches[0].clientY;});
forb.addEventListener('touchend',e=>{
  if(e.changedTouches[0].clientY-swY<-45&&state==='floating'){
    const now=new Date();
    itm.textContent=now.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'});
    const days=['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
    const mons=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    idt.textContent=`${days[now.getDay()]}, ${mons[now.getMonth()]} ${now.getDate()}`;
    icard.style.left=Math.min(window.innerWidth-245,Math.max(15,orbPos.x-80))+'px';
    icard.style.top=(orbPos.y-170)+'px';
    icard.classList.add('vis');
    clearTimeout(icardT);icardT=setTimeout(()=>icard.classList.remove('vis'),4000);
  }
});
icard.addEventListener('click',()=>icard.classList.remove('vis'));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LAUNCHER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const launcher=document.getElementById('launcher');
const lorb=document.getElementById('lorb');
const lcanvas=document.getElementById('lcanvas');
const lctx=lcanvas.getContext('2d');
const lsugg=document.getElementById('lsugg');
const adrawer=document.getElementById('adrawer');
const adgrid=document.getElementById('adgrid');
const nshade=document.getElementById('nshade');
const ambov=document.getElementById('ambov');
const ambtm=document.getElementById('ambtm');
let lparts=mkParts(1400);
let lrotY=0;

function initLCanvas(){
  const sz=Math.min(window.innerWidth*.75,320);
  lcanvas.width=sz*dpr;lcanvas.height=sz*dpr;
  lcanvas.style.width=sz+'px';lcanvas.style.height=sz+'px';
  lctx.setTransform(dpr,0,0,dpr,0,0);
}
initLCanvas();

function animLauncher(){
  if(mode!=='launcher'||state==='ambient'){requestAnimationFrame(animLauncher);return;}
  lrotY+=.001;
  const sz=parseInt(lcanvas.style.width);
  renderSphere(lctx,lparts,sz,sz,lrotY);
  requestAnimationFrame(animLauncher);
}
animLauncher();

function buildSugg(){
  const h=new Date().getHours();
  let apps;
  if(h>=6&&h<12)apps=[APPS[4],APPS[5],APPS[3]];
  else if(h>=18)apps=[APPS[6],APPS[3],APPS[1]];
  else apps=[APPS[4],APPS[5],APPS[3]];
  lsugg.innerHTML='<span class="lsugg-lbl">Suggested</span>';
  apps.forEach(a=>{
    const p=document.createElement('div');p.className='lsugg-pill';
    p.innerHTML=`<div class="lsugg-icon" style="background:${a.c}">${ICONS[a.i].replace(/stroke=/g,'fill=').replace('stroke-width="1.5"','')}</div><span class="lsugg-name">${a.n}</span>`;
    p.addEventListener('click',()=>{haptic(20);toast(`Opening ${a.n}...`);});
    lsugg.appendChild(p);
  });
}
buildSugg();

function buildDrawer(){
  adgrid.innerHTML='';
  [...APPS,...GRID_APPS].sort((a,b)=>(a.n||a.name).localeCompare(b.n||b.name)).forEach(a=>{
    const d=document.createElement('div');d.className='appi';d.style.filter='none';
    d.innerHTML=`<div class="appi-box" style="background:${a.c||a.color}">${ICONS[a.i]||'<svg viewBox="0 0 24 24"><rect x="7" y="7" width="10" height="10" rx="2" fill="#fff"/></svg>'}</div><span class="appi-lbl">${a.n||a.name}</span>`;
    d.addEventListener('click',()=>{haptic(20);toast(`Opening ${a.n||a.name}...`);adrawer.classList.remove('open');});
    adgrid.appendChild(d);
  });
}
buildDrawer();

lorb.addEventListener('click',()=>{if(mode==='launcher'&&state==='floating')expand();});

let lswY=0;
launcher.addEventListener('touchstart',e=>{lswY=e.touches[0].clientY;});
launcher.addEventListener('touchend',e=>{
  const dy=e.changedTouches[0].clientY-lswY;
  if(dy<-80&&lswY>window.innerHeight*.7)adrawer.classList.add('open');
  if(dy>80&&lswY<60)nshade.classList.add('open');
});
adrawer.addEventListener('click',e=>{if(e.target===adrawer||e.target.classList.contains('adrawer-handle'))adrawer.classList.remove('open');});
nshade.querySelectorAll('.ncard').forEach(c=>c.addEventListener('click',()=>{haptic(15);toast('Opening...');nshade.classList.remove('open');}));
document.addEventListener('touchend',e=>{if(nshade.classList.contains('open')&&e.changedTouches[0].clientY-lswY>80)nshade.classList.remove('open');});

// Double-tap ambient
let lastTap=0;
lorb.addEventListener('click',()=>{
  const now=Date.now();
  if(now-lastTap<300&&state==='floating'){
    state='ambient';
    ambtm.textContent=new Date().toLocaleTimeString([],{hour:'numeric',minute:'2-digit'});
    ambov.classList.add('vis');ambtm.classList.add('vis');
  }
  lastTap=now;
});
ambov.addEventListener('click',()=>{state='floating';ambov.classList.remove('vis');ambtm.classList.remove('vis');});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODE SWITCH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const mswitch=document.getElementById('mswitch');
const home=document.getElementById('home');

mswitch.querySelectorAll('.mswitch-btn').forEach(b=>b.addEventListener('click',()=>switchMode(b.dataset.m)));

function switchMode(m){
  mode=m;localStorage.setItem('orb_mode',m);
  mswitch.querySelectorAll('.mswitch-btn').forEach(b=>b.classList.toggle('active',b.dataset.m===m));
  forb.style.display=m==='overlay'?'block':'none';
  home.classList.toggle('hidden',m!=='overlay');
  launcher.classList.toggle('active',m==='launcher');
  overlay.classList.remove('active');
  exporb.classList.remove('active');
  voverlay.classList.remove('active');
  vorb.classList.remove('active');
  state='floating';
  if(m==='overlay'){forb.style.opacity='1';updForb();startTimers();}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BUILD HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const appgrid=document.getElementById('appgrid');
const dock=document.getElementById('dock');

GRID_APPS.forEach(a=>{
  const d=document.createElement('div');d.className='appi';
  d.innerHTML=`<div class="appi-box" style="background:${a.c}"><svg viewBox="0 0 24 24"><rect x="7" y="7" width="10" height="10" rx="2" fill="rgba(255,255,255,.85)"/></svg></div><span class="appi-lbl">${a.n}</span>`;
  appgrid.appendChild(d);
});

DOCK_APPS.forEach(n=>{
  const a=APPS.find(x=>x.i===n);
  const d=document.createElement('div');d.className='appi';d.style.filter='none';
  d.innerHTML=`<div class="appi-box" style="background:${a.c}">${ICONS[a.i]}</div>`;
  dock.appendChild(d);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function haptic(p){if(navigator.vibrate)navigator.vibrate(p);}
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('vis');setTimeout(()=>t.classList.remove('vis'),1500);}
function updClock(){
  const t=new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',hour12:true});
  document.getElementById('clock').textContent=t;
  document.getElementById('lclock').textContent=t;
}
updClock();setInterval(updClock,10000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ONBOARDING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const onboard=document.getElementById('onboard');
if(!localStorage.getItem('orb_onboarded')){
  forb.style.opacity='0';forb.style.transform='translate('+orbPos.x+'px,'+orbPos.y+'px) scale(0)';
  setTimeout(()=>{
    forb.style.transition='all .8s cubic-bezier(.175,.885,.32,1.275)';
    forb.style.opacity='1';forb.style.transform='translate('+orbPos.x+'px,'+orbPos.y+'px) scale(1)';
    setTimeout(()=>{forb.style.transition='';},800);
  },1000);
  onboard.style.left=(orbPos.x-60)+'px';onboard.style.top=(orbPos.y+80)+'px';
  setTimeout(()=>onboard.classList.add('vis'),1800);
  setTimeout(()=>onboard.classList.remove('vis'),5500);
  localStorage.setItem('orb_onboarded','true');
}

// Init
switchMode(mode);
if('serviceWorker'in navigator)navigator.serviceWorker.register('sw.js').catch(()=>{});
</script>
</body>
</html>
